
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Assemble data for the Met Office Global Analysis video &#8212; Machine Learning GCM</title>
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Plot one frame from the MO global analysis video" href="plot.html" />
    <link rel="prev" title="Big data: Near-surface temperature, wind, and precipitation, from the Met Office global analysis" href="index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="plot.html" title="Plot one frame from the MO global analysis video"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Big data: Near-surface temperature, wind, and precipitation, from the Met Office global analysis"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">ML GCM</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Big data: Near-surface temperature, wind, and precipitation, from the Met Office global analysis</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/Weather-Network.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html"> Big data: Near-surface temperature, wind, and precipitation, from the Met Office global analysis</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../20CRv2c_global_analysis/index.html"> Medium-sized data: Near-surface temperature, wind, and mean-sea-level pressure, from the Twentieth Century Reanalysis version 2c</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../data/download.html">Download training data</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../data/conversion.html">Process training data for TensorFlow</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../models/autoencoder/index.html">A variational autoencoder</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../20CRv2c_latent_space/index.html"> Small data: Near-surface temperature, wind, and mean-sea-level pressure, from the Twentieth Century Reanalysis version 2c, after compression into a 100-dimensional latent space.</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../models/generator/generator.html">A generative model</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../models/predictor/index.html">A +6hr predictor</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../models/GCM/index.html">A Machine-Learning GCM using the +6hr predictor</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../GCM_video/index.html"> Simulated data: Near-surface temperature, wind, and mean-sea-level pressure, from the Machine-Learning GCM.</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../presentations/index.html">Presentation decks and poster</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../credits.html">Small Print</a></li>
</ul>
<h3><a href="https://github.com/philip-brohan/ML_GCM">Get the source code</a></h3>

<a href="https://github.com/philip-brohan/ML_GCM"
           rel="nofollow">Github source repository</a>

<h3>Found a bug, or have a suggestion?</h3>

Please <a href="https://github.com/philip-brohan/ML_GCM/issues/new">raise an issue</a>.
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="assemble-data-for-the-met-office-global-analysis-video">
<h1>Assemble data for the Met Office Global Analysis video<a class="headerlink" href="#assemble-data-for-the-met-office-global-analysis-video" title="Permalink to this headline">Â¶</a></h1>
<p><em>Note</em>: To get this data you will need access to the Met Office operational MASS archive, and such access is not generally available outside the Met Office. The same data are distributed through the <a class="reference external" href="https://www.metoffice.gov.uk/services/data/met-office-data-for-reuse/discovery">Met Office Data Portal</a> <em>but</em> only a few days data is online at any one time.</p>
<p>The analysis is run once every 6 hours, but we want data at a higher time resolution than that. So we collect hourly data (the highest time resolution output) - each analysis, and the first 5 hours of forecast.</p>
<p>Script to collect the variables shown for all the analyses run in one calendar day:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># Retrieve surface weather variables from the global analysis</span>
<span class="c1">#  for one day.</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">tempfile</span> <span class="k">import</span> <span class="n">NamedTemporaryFile</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--year&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--month&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Integer month&quot;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--day&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Day of month&quot;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--opdir&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Directory for output files&quot;</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/opfc/glm&quot;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;SCRATCH&#39;</span><span class="p">))</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="n">opdir</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%04d</span><span class="s2">/</span><span class="si">%02d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">opdir</span><span class="p">,</span><span class="n">args</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">args</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">opdir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">opdir</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%04d</span><span class="s2">-</span><span class="si">%02d</span><span class="s2">-</span><span class="si">%02d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">args</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">args</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>

<span class="c1"># Mass directory to use</span>
<span class="n">mass_dir</span><span class="o">=</span><span class="s2">&quot;moose:/opfc/atm/global/prods/</span><span class="si">%04d</span><span class="s2">.pp&quot;</span> <span class="o">%</span> <span class="n">args</span><span class="o">.</span><span class="n">year</span>

<span class="c1"># Files to retrieve from</span>
<span class="n">flist</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">hour</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">18</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">fcst</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span>
        <span class="n">flist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;prods_op_gl-mn_</span><span class="si">%04d%02d%02d</span><span class="s2">_</span><span class="si">%02d</span><span class="s2">_</span><span class="si">%03d</span><span class="s2">.pp&quot;</span> <span class="o">%</span> <span class="p">(</span>
                       <span class="n">args</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">args</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">args</span><span class="o">.</span><span class="n">day</span><span class="p">,</span><span class="n">hour</span><span class="p">,</span><span class="n">fcst</span><span class="p">))</span>
        <span class="n">flist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;prods_op_gl-mn_</span><span class="si">%04d%02d%02d</span><span class="s2">_</span><span class="si">%02d</span><span class="s2">_</span><span class="si">%03d</span><span class="s2">.calc.pp&quot;</span> <span class="o">%</span> <span class="p">(</span>
                       <span class="n">args</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">args</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">args</span><span class="o">.</span><span class="n">day</span><span class="p">,</span><span class="n">hour</span><span class="p">,</span><span class="n">fcst</span><span class="p">))</span>
        <span class="n">flist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;prods_op_gl-up_</span><span class="si">%04d%02d%02d</span><span class="s2">_</span><span class="si">%02d</span><span class="s2">_</span><span class="si">%03d</span><span class="s2">.calc.pp&quot;</span> <span class="o">%</span> <span class="p">(</span>
                       <span class="n">args</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">args</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">args</span><span class="o">.</span><span class="n">day</span><span class="p">,</span><span class="n">hour</span><span class="p">,</span><span class="n">fcst</span><span class="p">))</span>

<span class="c1"># Create the query file</span>
<span class="n">qfile</span><span class="o">=</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">,</span><span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">qfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;begin_global</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">qfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;   pp_file = (&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ppfl</span> <span class="ow">in</span> <span class="n">flist</span><span class="p">:</span>
    <span class="n">qfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ppfl</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ppfl</span> <span class="o">!=</span> <span class="n">flist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">qfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">qfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">qfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;end_global</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">qfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;begin</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">qfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    stash = (16222,24,3236,31,3225,3226)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">qfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    lbproc = 0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">qfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;end</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">qfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;begin</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">qfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    stash = (5216,5206,5205,4203,4204)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">qfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    lbproc = 128</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">qfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;end</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">qfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Run the query</span>
<span class="n">opfile</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%02d</span><span class="s2">.pp&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">opdir</span><span class="p">,</span><span class="n">args</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
<span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;moo select -C </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">qfile</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">mass_dir</span><span class="p">,</span><span class="n">opfile</span><span class="p">),</span>
                 <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">qfile</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>This script must be run repeatedly to gather data for all the days shown in the video.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># Extract the data for a range of days</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">datetime</span>


<span class="c1"># Function to check if the job is already done for this timepoint</span>
<span class="k">def</span> <span class="nf">is_done</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="p">):</span>
    <span class="n">op_file_name</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/opfc/</span><span class="si">%04d</span><span class="s2">/</span><span class="si">%02d</span><span class="s2">/</span><span class="si">%02d</span><span class="s2">.pp&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;SCRATCH&#39;</span><span class="p">),</span>
                            <span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">op_file_name</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>

<span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;fetch2.txt&quot;</span><span class="p">,</span><span class="s2">&quot;w+&quot;</span><span class="p">)</span>

<span class="n">start_day</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2019</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">)</span>
<span class="n">end_day</span>  <span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">23</span><span class="p">)</span>

<span class="n">current_day</span><span class="o">=</span><span class="n">start_day</span>
<span class="k">while</span> <span class="n">current_day</span><span class="o">&gt;=</span><span class="n">end_day</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">is_done</span><span class="p">(</span><span class="n">current_day</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">current_day</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
                   <span class="n">current_day</span><span class="o">.</span><span class="n">day</span><span class="p">):</span>
        <span class="n">current_day</span><span class="o">=</span><span class="n">current_day</span><span class="o">-</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">continue</span>
    <span class="n">cmd</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;./get_data_for_day.py --year=</span><span class="si">%d</span><span class="s2"> --month=</span><span class="si">%d</span><span class="s2"> &quot;</span> <span class="o">+</span>
         <span class="s2">&quot;--day=</span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">+</span>
         <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span>
           <span class="n">current_day</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">current_day</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
             <span class="n">current_day</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="n">current_day</span><span class="o">=</span><span class="n">current_day</span><span class="o">-</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</pre></div>
</div>
<p>This produces a list of data retrieval commands - one for each day. Running these in parallel would overload the MASS system, so just run them in series - itâll take a few days to get all the data from tape.</p>
<p>As well as the weather data, the plot script needs a land-mask file to plot the continents. This script retrieves that.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># Download everything we need except the 20CR data.</span>
<span class="c1"># Store it on $SCRATCH</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>

<span class="c1"># Land mask for plots</span>

<span class="n">srce</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;https://s3-eu-west-1.amazonaws.com/&quot;</span><span class="o">+</span>
      <span class="s2">&quot;philip.brohan.org.ml-gcm/opfc_global_2019.nc&quot;</span><span class="p">)</span>
<span class="n">dst</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/fixed_fields/land_mask/opfc_global_2019.nc&quot;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;SCRATCH&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dst</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dst</span><span class="p">)):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dst</span><span class="p">))</span>
    <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">srce</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="plot.html" title="Plot one frame from the MO global analysis video"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Big data: Near-surface temperature, wind, and precipitation, from the Met Office global analysis"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">ML GCM</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Big data: Near-surface temperature, wind, and precipitation, from the Met Office global analysis</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    </div>
  </body>
</html>